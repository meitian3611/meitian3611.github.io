---
title: 跨域
date: 2019-10-23 21:00:19
tags:
	- 笔记
	- 知识点
categories: web前端
---

## Ajax跨域

> 由于浏览器的同源策略，禁止ajax从一个域名请求另外一个域名上的数据。
>
> 浏览器的同源策略，是对JavaScript实施的安全限制

**所谓的同源是指，域名，协议，端口都相同**

[http://image.baidu.com:80/search/detail?ct=503316480&z=undefined#header](http://image.baidu.com/search/detail?ct=503316480&z=undefined#header)

URL构成：http ---- 超文本传输协议

[image.baidu.com](http://image.baidu.com/) ---- 域名

80 ---- 端口

/search/detail ---- 资源目录

ct=503316480&z=undefined ---- 发送到服务器的数据

#header ---- 锚点

### 常见的跨域解决方案

1. **通过服务端语言代理请求。**

如PHP，服务端语言php是没有跨域限制的。 让服务器去别的网站获取内容然后返回页面。



2. **jsonp跨域**

   -  jsonp跨域就是利用script标签的跨域能力请求资源
   - 既然叫jsonp，显然目的还是json，而且是跨域获取
   - **利用js创建一个script标签，把json的url赋给script的scr属性，把这个script插入到页面里，让浏览器去跨域获取资源**

   - callback是页面存在的回调方法，参数就是想得到的json
   - 回调方法要遵从服务端的约定一般是用 callback 或者 cb

   - **jsonp只针对get请求**

```javascript
 OScript = document.createElement('script');//创建script标签 
 OScript.src = 'http://suggestion.baidu.com/su?wd=' + this.value + '&cb=myCallback';
 //把数据地址赋值给src
 document.body.appendChild(OScript);//添加到页面
```



3. **CORS 跨域资源共享(xhr2)**

实现CORS通信的关键是服务端，只要服务端实现了CORS接口，就可以跨源通信

实现CORS并不难，只需服务端做一些设置即可：

`<?phpheader("Access-Control-Allow-Origin:*"); // 允许任何来源`



### jQuery使用跨域

```javascript
<body>
<input type="text" class="ipt">
<button class="btn">请求jsonp数据</button>
<ul class="list"></ul>

<script src="../jquery-1.12.4.js"></script>
<script>
    $('.btn').click(function () {
        $.ajax({
            url: 'http://suggestion.baidu.com/su', // 输入接口地址
            type: 'get', 		//必须为get类型
            data: 'wd=' + $('.ipt').val(),
            cache: false,
            dataType: 'jsonp',  //修改为jsonp格式
            jsonp: 'cb',        //传入回调函数
            success: function (json) {
                $.each(json.s, function (index, val) {
                    $('.list').append('<li>' + val + '</li>');
                })
            },
            error: function (err) {
                alert('请求失败')
                console.log(err.status);
            }
        })
    })

</script>
</body>
```

